# 特教課表管理系統 - 功能紀錄與備份說明

**建立日期**: 2025-12-08  
**最後更新**: 2025-12-08 09:19

---

## 📋 系統概述

這是一個專為特殊教育班級設計的課表管理系統,支援課程分組、學生分組、教師管理、課表編排等完整功能。

---

## 🔧 今日更新內容 (2025-12-08)

### 1. 教室選單更新
**時間**: 08:33-08:35

**變更內容**:
- 將「知動教室」改名為「綜合球場」
- 新增「自訂」功能,允許手動輸入教室名稱

**修改檔案**:
- `script.js` (L385-L525)
  - `updateGroupPreview` 函數: 新增自訂教室邏輯
  - `handleSaveCourse` 函數: 處理自訂教室儲存

**技術細節**:
- 標準教室列表: ['待訂', '132教室', '133教室', '136教室', '137教室', '綜合球場']
- 自動偵測非標準教室名稱,自動選擇「自訂」選項
- 動態顯示/隱藏自訂輸入框

---

### 2. 學生池顯示問題修復
**時間**: 08:50-09:10

**問題描述**:
- 分組管理中,學生池區域空白,未顯示任何內容

**診斷過程**:
1. 添加詳細的 console.log 調試輸出
2. 發現所有學生都已分配到分組
3. 識別出 CSS 樣式問題

**解決方案**:
- **script.js** (L846-L886): 添加調試日誌和空狀態處理
- **index.css** (L488-L497): 新增 `.student-pool .empty-state` 專用樣式

**修改內容**:
```css
.student-pool .empty-state {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 2rem;
    color: #95a5a6;
    font-size: 1rem;
}
```

**結果**:
- 當所有學生已分配時,顯示「所有學生已分配」訊息
- 訊息正確置中顯示

---

### 3. 清除分組功能
**時間**: 09:10-09:18

**功能描述**:
新增「清除分組」按鈕,一鍵清除選定課程的所有學生分組

**修改檔案**:

**index.html** (L95-L104):
```html
<button id="btn-clear-assignments" class="btn-secondary" style="margin-left: 1rem; display: none;">
    <span>🗑️</span>
    <span>清除分組</span>
</button>
```

**script.js** (L234-L302):
- 新增 `currentGroupingCourseId` 變數追蹤當前課程
- 實作按鈕顯示/隱藏邏輯
- 實作清除分組函數,包含確認對話框

**功能特點**:
- ✅ 安全確認對話框
- ✅ 只影響選定課程
- ✅ 自動儲存到 localStorage
- ✅ 即時重新渲染

---

### 4. 總課表列印格式優化 (2025-12-08 12:21)
**功能描述**:
針對總課表 PDF 匯出與列印進行大幅度格式調整,以符合特定排版需求。

**主要特點**:
- **欄位重組**: 星期順序改為「五、四、三、二、一」,節次移至最右側。
- **2x2 Grid 佈局**:
  - 單一儲存格內若有多個分組課程,自動以 2x2 網格排列 (左右並排)。
  - 若只有一個分組,自動跨欄置中。
- **直式學生名單**:
  - 學生名單以直式清單呈現,確保與傳統格式一致。
- **大字體優化**:
  - 標題與表格字體增大至 12pt (粗體)。
  - 內容細節字體增大至 11pt,提升閱讀性。
- **頁面控制**:
  - 透過 CSS `zoom: 0.6` 與邊距縮減,強制將內容限制在 2 頁 A4 範圍內。

**修改檔案**:
- `index.html`: 調整表格 Header 順序。
- `script.js`:
  - `renderMasterSchedule`: 調整欄位渲染順序。
  - 新增 `day-cell-grid` 容器以解決 `td` Grid 佈局相容性問題。
- `index.css`:
  - 新增 `.day-cell-grid` 樣式。
  - 調整 `@media print` 字體大小與 Padding。

---

## 📁 備份檔案清單

### 今日備份 (2025-12-08)
```
script.js.bak.20251208_0918    - 主要 JavaScript 檔案
index.html.bak.20251208_0918   - HTML 結構檔案
index.css.bak.20251208_0918    - CSS 樣式檔案
script_backup_20251208_1221.js - 12:21 最終備份 (JS)
index_backup_20251208_1221.html- 12:21 最終備份 (HTML)
index_backup_20251208_1221.css - 12:21 最終備份 (CSS)
```

### 歷史備份
```
script.js.bak.20251206         - 2025-12-06 備份
script.js.bak.20251206_final   - 2025-12-06 最終版本
script.js.bak.20251206_final_v2 - 2025-12-06 最終版本 v2
script.js.bak.20251208         - 2025-12-08 早期備份
```

---

## 🎯 核心功能列表

### 1. 學生管理
- ✅ 新增/刪除學生
- ✅ 設定年級 (7/8/9)
- ✅ 點擊年級圖示快速切換年級
- ✅ 按年級排序顯示

### 2. 課程管理
- ✅ 新增/編輯/刪除課程
- ✅ 設定課程名稱 (預設選項 + 自訂)
- ✅ 設定分組數 (1-4組)
- ✅ 設定每週節數 (0-8節)
- ✅ 為每個分組設定:
  - 分組名稱
  - 授課教師 1 & 2
  - 教室 (標準選項 + **自訂**)

### 3. 教師管理
- ✅ 新增/編輯/刪除教師
- ✅ 設定基本鐘點

### 4. 分組管理
- ✅ 拖放式學生分組
- ✅ 學生池顯示未分配學生
- ✅ 空狀態提示訊息
- ✅ **清除分組功能** (新增)
- ✅ 查看所有課程分組總覽

### 5. 簡易課表
- ✅ 拖放式課程區塊排課
- ✅ 支援多個課程區塊同時排入
- ✅ 課表標題自訂
- ✅ 實施日期設定
- ✅ PDF 匯出/列印

### 6. 總課表
- ✅ 總課表檢視
- ✅ 教師個別課表
- ✅ 學生個別課表
- ✅ 教室個別課表
- ✅ PDF 匯出/列印

---

## 🗄️ 資料儲存結構

### LocalStorage Keys
```javascript
{
  "students": [],           // 學生資料
  "courses": [],            // 課程資料
  "teachers": [],           // 教師資料
  "assignments": {},        // 分組資料
  "scheduleData": {},       // 課表資料
  "teacherPartTimeMarks": {}, // 教師兼課標記
  "scheduleTitle": {},      // 課表標題
  "implementationDates": {}, // 實施日期
  "studentManualEntries": {} // 學生手動輸入
}
```

---

## 🔍 調試功能

### Console 日誌
`renderStudentPool` 函數包含詳細的調試輸出:
- 課程 ID
- 學生池容器狀態
- 系統中學生總數
- 課程分組資料
- 已分配學生 ID
- 未分配學生列表

**查看方式**:
1. 按 F12 開啟開發者工具
2. 切換到 Console 標籤
3. 選擇課程觸發 `renderStudentPool`

---

## 📝 技術規格

### 前端技術
- **HTML5**: 語義化標籤
- **CSS3**: Flexbox, Grid, 自訂屬性
- **JavaScript (ES6+)**: 
  - 模組化函數設計
  - LocalStorage 資料持久化
  - 拖放 API
  - 事件委派

### 瀏覽器支援
- Chrome/Edge (推薦)
- Firefox
- Safari

### 檔案結構
```
特教課表Special Education Curriculum/
├── index.html              - 主頁面
├── index.css               - 樣式表
├── script.js               - 主要邏輯
├── *.bak.*                 - 備份檔案
└── BACKUP_LOG_20251208.md  - 備份紀錄
```

---

## 🚀 使用指南

### 基本流程
1. **新增學生** → 學生管理
2. **新增教師** → 教師管理
3. **新增課程** → 課程管理
4. **分組學生** → 分組管理
5. **排課** → 簡易課表
6. **檢視** → 總課表

### 重要提示
- ⚠️ 所有資料儲存在瀏覽器 LocalStorage
- ⚠️ 清除瀏覽器資料會遺失所有內容
- ⚠️ 建議定期匯出 PDF 備份
- ⚠️ 重要修改前建議先備份檔案

---

## 🔄 還原方式

### 從備份還原
```powershell
# 還原 script.js
Copy-Item "script.js.bak.20251208_0918" "script.js"

# 還原 index.html
Copy-Item "index.html.bak.20251208_0918" "index.html"

# 還原 index.css
Copy-Item "index.css.bak.20251208_0918" "index.css"
```

### 還原 LocalStorage 資料
1. 開啟開發者工具 (F12)
2. 切換到 Application 標籤
3. 左側選擇 Local Storage
4. 手動編輯或匯入資料

---

## 📞 維護資訊

### 已知問題
- 無

### 待開發功能
- 資料匯出/匯入功能
- 批次操作功能
- 更多課表檢視選項

### 版本歷史
- **v1.3** (2025-12-08): 新增清除分組功能、修復學生池顯示、更新教室選單
- **v1.2** (2025-12-06): PDF 匯出優化
- **v1.1** (2025-12-04): 修復顯示問題
- **v1.0** (2025-12-01): 初始版本

---

## 📄 授權與版權

此系統為特殊教育課表管理專用工具。

---

**文檔結束**
